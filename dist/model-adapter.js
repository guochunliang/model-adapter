!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).ModelAdapter=r()}(this,function(){"use strict";function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t){var r=f(t);return null!==t&&("object"===r||"function"===r)}function l(t){for(var r=t.split("."),n=[],o=0;o<r.length;o++){for(var e=r[o];"\\"===e[e.length-1]&&void 0!==r[o+1];)e=e.slice(0,-1)+".",e+=r[++o];n.push(e)}return n}var a=function(t,r,n){if(!u(t)||"string"!=typeof r)return void 0===n?t:n;for(var o=l(r),e=0;e<o.length;e++){if(!Object.prototype.propertyIsEnumerable.call(t,o[e]))return n;if(null==(t=t[o[e]])){if(e!==o.length-1)return n;break}}return t},c=function(t,r,n){if(!u(t)||"string"!=typeof r)return t;for(var o=t,e=l(r),i=0;i<e.length;i++){var a=e[i];u(t[a])||(t[a]={}),i===e.length-1&&(t[a]=n),t=t[a]}return o};function s(t,r){var n,o,e,i,a;return"string"==typeof t||"function"==typeof t?n=t:t&&"object"===f(t)&&(n=t.path,o=t.defaultValue,e=t.validator,i=t.transformer,a=t.restorer),n?"function"==typeof n&&(n=n()):n=r,"function"==typeof o&&(o=o()),{path:n,defaultValue:o,validator:e,transformer:i,restorer:a}}function p(t,r){if(r.validator){var n=!1;if("string"==typeof r.validator)n=f(t)===r.validator;else if(r.validator instanceof RegExp)n=r.validator.test(t);else if("function"==typeof r.validator)try{n=r.validator(t)}catch(t){console.error("验证器执行异常",t)}n||console.warn("验证数据不通过",r.path,t,r.validator,r)}}return function t(r,n){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t);var e=r,i=n;this.$adapt=function(t){o&&(e=Object.assign(function(t){var r={};for(var n in t)r[n]=n;return r}(t),e)),function(t,r,n){for(var o in n){var e=s(n[o],o),i=a(r,e.path,e.defaultValue);void 0!==r&&p(i,e),e.transformer&&(i=e.transformer(i,r)),t[o]=i}}(this,t,e)},this.$restore=function(){return function(t,r){var n={};for(var o in r){var e=s(r[o],o),i=t[o];e.restorer&&(i=e.restorer(i,t)),p(i,e),c(n,e.path,i)}return n}(this,e)},this.$adapt(i)}});
