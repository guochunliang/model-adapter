!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).ModelAdapter=r()}(this,function(){"use strict";function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t){var r=f(t);return null!==t&&("object"===r||"function"===r)}function l(t){for(var r=t.split("."),o=[],n=0;n<r.length;n++){for(var e=r[n];"\\"===e[e.length-1]&&void 0!==r[n+1];)e=e.slice(0,-1)+".",e+=r[++n];o.push(e)}return o}var i=function(t,r,o){if(!u(t)||"string"!=typeof r)return void 0===o?t:o;for(var n=l(r),e=0;e<n.length;e++){if(!Object.prototype.propertyIsEnumerable.call(t,n[e]))return o;if(null==(t=t[n[e]])){if(e!==n.length-1)return o;break}}return t},s=function(t,r,o){if(!u(t)||"string"!=typeof r)return t;for(var n=t,e=l(r),a=0;a<e.length;a++){var i=e[a];u(t[i])||(t[i]={}),a===e.length-1&&(t[i]=o),t=t[i]}return n};function c(t,r){var o,n,e,a,i;return"string"==typeof t||"function"==typeof t?o=t:t&&"object"===f(t)&&(o=t.path,n=t.defaultValue,e=t.validator,a=t.transformer,i=t.restorer),o?"function"==typeof o&&(o=o()):o=r,"function"==typeof n&&(n=n()),{path:o,defaultValue:n,validator:e,transformer:a,restorer:i}}function v(t,r){if(r.validator){var o=!1;if("string"==typeof r.validator)o=f(t)===r.validator;else if(r.validator instanceof RegExp)o=r.validator.test(t);else if("function"==typeof r.validator)try{o=r.validator(t)}catch(t){console.error("validator error",t)}else console.warn("unknown type of validator",r.validator,r);o||console.warn("validator result is invalid",r.path,t,r.validator,r)}}return function t(r,o){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t);var e=r,a=o;this.$adapt=function(t){n&&(e=Object.assign(function(t){var r={};for(var o in t)r[o]=o;return r}(t),e)),function(t,r,o){for(var n in o){var e=c(o[n],n),a=i(r,e.path);null==a&&void 0!==e.defaultValue&&(a=e.defaultValue),void 0!==r&&v(a,e),e.transformer&&(a=e.transformer(a,r)),t[n]=a}}(this,t,e)},this.$restore=function(){return function(t,r){var o={};for(var n in r){var e=c(r[n],n),a=t[n];e.restorer&&(a=e.restorer(a,t)),v(a,e),s(o,e.path,a)}return o}(this,e)},this.$adapt(a)}});
