!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ModelAdapter=t()}(this,function(){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){var t=r(e);return null!==e&&("object"===t||"function"===t)}function l(e){for(var t=e.split("."),r=[],n=0;n<t.length;n++){for(var o=t[n];"\\"===o[o.length-1]&&void 0!==t[n+1];)o=o.slice(0,-1)+".",o+=t[++n];r.push(o)}return r}var a={get:function(e,t,r){if(!u(e)||"string"!=typeof t)return void 0===r?e:r;for(var n=l(t),o=0;o<n.length;o++){if(!Object.prototype.propertyIsEnumerable.call(e,n[o]))return r;if(null==(e=e[n[o]])){if(o!==n.length-1)return r;break}}return e},set:function(e,t,r){if(!u(e)||"string"!=typeof t)return e;for(var n=e,o=l(t),i=0;i<o.length;i++){var f=o[i];u(e[f])||(e[f]={}),i===o.length-1&&(e[f]=r),e=e[f]}return n},delete:function(e,t){if(u(e)&&"string"==typeof t)for(var r=l(t),n=0;n<r.length;n++){var o=r[n];if(n===r.length-1)return void delete e[o];if(e=e[o],!u(e))return}},has:function(e,t){if(!u(e)||"string"!=typeof t)return!1;for(var r=l(t),n=0;n<r.length;n++){if(!u(e))return!1;if(!(r[n]in e))return!1;e=e[r[n]]}return!0}},c=require("@fav/prop.enum-own-props"),s=require("@fav/type.is-plain-object");function p(e){for(var t=1,r=arguments.length;t<r;t++)v(e,arguments[t]);return e}function v(e,t){for(var r=c(t),n=0,o=r.length;n<o;n++){var i=r[n],f=t[i],u=e[i];if(s(f)){if(null==u)e[i]=u={};else if(!s(u))continue;v(u,f)}else if(null==u)try{e[i]=f}catch(e){}}}function h(e){for(var t=e.split("."),r=[],n=0;n<t.length;n++){for(var o=t[n];"\\"===o[o.length-1]&&void 0!==t[n+1];)o=o.slice(0,-1)+".",o+=t[++n];r.push(o)}return r}function g(e,t){var r=null,n=h(t);if(1===n.length)r=e;else{var o=n.slice(0,n.length-1).join(".");null==(r=a.get(e,o))&&(r={},a.set(e,o,r))}return r}function y(t,e,r){for(var n in e){var o=e[n]||{};if(o.transformer){var i=h(n),f=i[i.length-1],u=g(t,n),l=a.get(t,n);a.set(r,n,l),Object.defineProperty(u,f,{get:function(){var e=a.get(r,n);return o.transformer(e,t)},set:function(e){a.set(r,n,e)},configurable:!0,enumerable:!0})}}return t}return function e(t,r){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=n,i=t,f={};Object.defineProperty(this,"$getSource",{value:function(e){return e?a.get(i,e):i}}),Object.defineProperty(this,"$setSource",{value:function(e){for(var t in this)"function"!=typeof this[t]&&delete this[t];f={},p(this,i=e,r),y(this,o,f)}}),Object.defineProperty(this,"$setAdapter",{value:function(e,t){t?o[e]=t:delete o[e],y(this,o,f)}}),Object.defineProperty(this,"$restore",{value:function(e){var t=function(e,t,r){var n=p({},e);for(var o in t){if((t[o]||{}).transformer){var i=h(o),f=i[i.length-1],u=a.get(r,o),l=g(n,o);Object.defineProperty(l,f,{value:u,configurable:!0,enumerable:!0,writable:!0})}}return n}(this,o,f);return e?a.get(t,e):t}}),this.$setSource(t)}});
